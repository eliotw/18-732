
section .text

	global _start

_start:

	jmp short	OpenCall

open:

	pop esi
	xor eax, eax
	mov byte 	[esi + 7], al
	lea ebx, [esi]
	xor ecx, ecx
	mov cl, 65		; Moved to lower ecx to remove nulls
	mov dx, 438		; Moved to lower edx to remove nulls
	mov al, 5
	int 0x80	
	push eax
	jmp short	WriteCall	

write:

	pop esi			; pop string pointer into esi
	xor eax, eax		; create null byte in eax
	mov byte [esi], 72
	inc byte [esi]
	mov byte [esi + 6], al	; add null terminator (probably not needed)
	lea	ecx, [esi]	; load string pointer into ecx
	pop ebx			; pop fd to ebx
	xor edx, edx		; Clear out edx or else we will write more bytes than we want
	mov dl, 6		; Write only 6 bytes
	mov al, 4		; Set eax to 4 for write syscall
	int 0x80

close:
	xor eax, eax
	mov al, 6
	int 0x80

exit:

	xor ebx, ebx
	xor eax, eax
	mov al, 1
	int 0x80

OpenCall:

	Call open
	Db	'bar.txtA'

WriteCall:

	Call write
	Db	'I win!A'
