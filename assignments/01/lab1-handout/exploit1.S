.code32
.text
    movl     %eip, %ebx
    subl     $0x86, %ebx # %ebx contains the start of the name of the file (foo.txt)
    movw     $0666,%dx # give all users read and write privileges
    movb     $0101,%cl # write and create (O_WRONLY | O_CREAT)
    movb     $5,%al    # syscall number (sys_open)
    int      $0x80     # call kernel (resulting fd is stored in %eax)

    push     %eax      # store file descriptor

    movb     $9,%dl  # length of message to write
    movb     msg,%cl  # message to write ("You lose!")
    movl     %eax,%ebx  # file descriptor (returned by open)
    movb     $4,%al    # syscall number (sys_write)
    int      $0x80     # call kernel

    pop      %ebx      # load file descriptor

    movb     $6,%al   # syscall number (sys_close)
    int      $0x80     # call kernel

msg:
    .ASCII "foo.txt"
file:
    .ASCII "You lose!"
